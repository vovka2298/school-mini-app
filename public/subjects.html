<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>–ú–æ–∏ –ø—Ä–µ–¥–º–µ—Ç—ã</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìö</text></svg>">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      margin: 0;
      background: #0d1117;
      color: #c9d1d9;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 20px;
    }
    
    .back-btn {
      background: #21262d;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      cursor: pointer;
      font-size: 14px;
      width: 100%;
      text-align: left;
    }
    
    .back-btn:hover {
      background: #30363d;
    }
    
    h1 {
      font-size: 24px;
      margin-bottom: 8px;
    }
    
    .subtitle {
      color: #8b949e;
      margin-bottom: 24px;
    }
    
    .card {
      background: #161b22;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .subjects-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .subject-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: #21262d;
      border-radius: 8px;
      cursor: pointer;
    }
    
    .subject-item:hover {
      background: #30363d;
    }
    
    .subject-item input {
      width: 18px;
      height: 18px;
    }
    
    .gender-section {
      margin: 20px 0;
    }
    
    .gender-options {
      display: flex;
      gap: 20px;
      margin-top: 10px;
    }
    
    .gender-option {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .save-btn {
      background: #1f6feb;
      color: white;
      border: none;
      padding: 16px;
      border-radius: 12px;
      width: 100%;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 20px;
    }
    
    .save-btn:hover {
      background: #1565c0;
    }
  </style>
</head>
<body>
  <button class="back-btn" onclick="window.location.href='/'">‚Üê –ù–∞–∑–∞–¥ –∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é</button>
  
  <h1>–ú–æ–∏ –ø—Ä–µ–¥–º–µ—Ç—ã</h1>
  <p class="subtitle">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–≥–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –ø—Ä–µ–ø–æ–¥–∞–µ—Ç–µ</p>
  
  <div class="card">
    <div class="subjects-grid" id="subjectsList">
      <!-- –ü—Ä–µ–¥–º–µ—Ç—ã –∑–∞–≥—Ä—É–∑—è—Ç—Å—è –∑–¥–µ—Å—å -->
    </div>
    
    <div class="gender-section">
      <p>–£–∫–∞–∂–∏—Ç–µ –≤–∞—à –ø–æ–ª</p>
      <div class="gender-options">
        <label class="gender-option">
          <input type="radio" name="gender" value="–ú—É–∂—Å–∫–æ–π" checked>
          <span>–ú—É–∂—Å–∫–æ–π</span>
        </label>
        <label class="gender-option">
          <input type="radio" name="gender" value="–ñ–µ–Ω—Å–∫–∏–π">
          <span>–ñ–µ–Ω—Å–∫–∏–π</span>
        </label>
      </div>
    </div>
    
    <button class="save-btn" onclick="saveProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
  </div>

  <script>
    // Telegram Web App
    if (typeof Telegram !== 'undefined') {
      Telegram.WebApp.ready();
      Telegram.WebApp.expand();
    }
    
    // –î–∞–Ω–Ω—ã–µ
    const SUBJECTS = [
      "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞–ë–∞–∑–∞", "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞–û–ì–≠", "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞–ï–ì–≠", "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞5_8", "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞9_11",
      "–§–∏–∑–∏–∫–∞5_8", "–§–∏–∑–∏–∫–∞–û–ì–≠", "–§–∏–∑–∏–∫–∞–ï–ì–≠", "–§–∏–∑–∏–∫–∞9_11", "–í—ã—Å—à–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞", "–û–ª–∏–º–ø–∏–∞–¥–∞",
      "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞", "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ", "–•–∏–º–∏—è", "–ë–∏–æ–ª–æ–≥–∏—è", "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫",
      "–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫", "–û–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ", "–ò—Å—Ç–æ—Ä–∏—è", "–ì–µ–æ–≥—Ä–∞—Ñ–∏—è"
    ];
    
    let profile = {
      subjects: [],
      gender: "–ú—É–∂—Å–∫–æ–π"
    };
    const MY_ID = "913096324";
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
    async function loadProfile() {
      try {
        const response = await fetch(`/api/profile/${MY_ID}`);
        const data = await response.json();
        profile = data;
        renderSubjects();
      } catch (error) {
        console.log("–ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—É—Å—Ç–æ–π –ø—Ä–æ—Ñ–∏–ª—å");
        renderSubjects();
      }
    }
    
    // –†–µ–Ω–¥–µ—Ä –ø—Ä–µ–¥–º–µ—Ç–æ–≤
    function renderSubjects() {
      const container = document.getElementById('subjectsList');
      container.innerHTML = SUBJECTS.map(subject => {
        const checked = profile.subjects.includes(subject);
        const displayName = subject.replace(/_/g, ' ');
        return `
          <label class="subject-item">
            <input type="checkbox" ${checked ? 'checked' : ''} 
                   onchange="toggleSubject('${subject}', this.checked)">
            <span>${displayName}</span>
          </label>
        `;
      }).join('');
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–ª
      document.querySelectorAll('input[name="gender"]').forEach(radio => {
        radio.checked = radio.value === profile.gender;
      });
    }
    
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞
    function toggleSubject(subject, isChecked) {
      if (isChecked) {
        if (!profile.subjects.includes(subject)) {
          profile.subjects.push(subject);
        }
      } else {
        profile.subjects = profile.subjects.filter(s => s !== subject);
      }
    }
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
    async function saveProfile() {
      // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª
      const genderRadio = document.querySelector('input[name="gender"]:checked');
      if (genderRadio) {
        profile.gender = genderRadio.value;
      }
      
      try {
        await fetch(`/api/profile/${MY_ID}`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(profile)
        });
        
        alert("–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω!");
        window.location.href = '/';
      } catch (error) {
        alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è");
      }
    }
    
    // –ó–∞–ø—É—Å–∫
    window.onload = loadProfile;
  </script>
</body>
</html>
