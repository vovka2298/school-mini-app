<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>–ö–∞–±–∏–Ω–µ—Ç –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìÖ</text></svg>">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            margin: 0;
            background: #0d1117;
            color: #c9d1d9;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .header {
            background: #161b22;
            padding: 16px;
            border-bottom: 1px solid #30363d;
        }
        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 14px;
        }
        .avatar {
            width: 52px;
            height: 52px;
            border-radius: 50%;
            border: 3px solid #58a6ff;
            background: #21262d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        .refresh-btn {
            background: #238636;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
            white-space: nowrap;
        }
        .refresh-btn:hover {
            background: #2ea043;
        }
        .refresh-btn:active {
            transform: scale(0.98);
        }
        .tabs {
            display: flex;
            background: #161b22;
            border-bottom: 1px solid #30363d;
        }
        .tab {
            flex: 1;
            padding: 16px;
            text-align: center;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            user-select: none;
        }
        .tab.active {
            background: #1f6feb;
            color: white;
        }
        .legend {
            padding: 14px;
            background: #161b22;
            display: flex;
            justify-content: center;
            gap: 24px;
            font-size: 13px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-box {
            width: 16px;
            height: 16px;
            border-radius: 6px;
        }
        .content {
            padding: 12px;
            height: calc(100vh - 250px);
            overflow-y: auto;
            position: relative;
        }
        .week-header {
            display: flex;
            margin-left: 68px;
            margin-bottom: 8px;
            font-size: 12px;
            color: #8b949e;
        }
        .day-name {
            width: 88px;
            text-align: center;
            flex: none;
        }
        .time-row {
            display: flex;
            align-items: center;
            margin: 3px 0;
        }
        .time-label {
            width: 68px;
            text-align: right;
            font-size: 13px;
            color: #8b949e;
            padding-right: 12px;
            flex: none;
        }
        .slots {
            display: flex;
            flex: 1;
        }
        .slot {
            width: 80px;
            height: 56px;
            margin: 0 4px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            overflow: hidden;
            user-select: none;
        }
        .slot:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .state-0 {
            background: #21262d;
            color: #8b949e;
        }
        .state-1 {
            background: #238636;
            color: white;
        }
        .state-2 {
            background: #da3633;
            color: white;
        }
        .slot-time {
            font-size: 9px;
            opacity: 0.8;
            margin-bottom: 3px;
        }
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #8b949e;
            font-size: 16px;
        }
        .error {
            text-align: center;
            padding: 60px 20px;
            color: #da3633;
        }
        .sync-notice {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #1f6feb;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            animation: fadeIn 0.3s;
            z-index: 1000;
        }
        .cache-notice {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #ffa500;
            color: #000;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            animation: fadeIn 0.3s;
            z-index: 1000;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        button {
            font-family: inherit;
        }
        #lastSync {
            font-size: 11px;
            color: #8b949e;
            text-align: center;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-top">
            <div class="user-info">
                <div class="avatar">üë®üè´</div>
                <div>
                    <h3 id="userName">–ó–∞–≥—Ä—É–∑–∫–∞...</h3>
                    <p>–ö–∞–±–∏–Ω–µ—Ç –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è</p>
                </div>
            </div>
            <button class="refresh-btn" id="refreshBtn" onclick="forceRefresh()">
                üîÑ –û–±–Ω–æ–≤–∏—Ç—å
            </button>
        </div>
        <div id="lastSync"></div>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="showSchedule()">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</div>
        <div class="tab" onclick="showBookings()">–ó–∞—è–≤–∫–∏</div>
        <div class="tab" onclick="showStudents()">–£—á–µ–Ω–∏–∫–∏</div>
    </div>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-box state-0"></div>
            <span>–°–≤–æ–±–æ–¥–µ–Ω</span>
        </div>
        <div class="legend-item">
            <div class="legend-box state-1"></div>
            <span>–ó–∞–Ω—è—Ç</span>
        </div>
        <div class="legend-item">
            <div class="legend-box state-2"></div>
            <span>–ù–µ —Ä–∞–±–æ—Ç–∞—é</span>
        </div>
    </div>

    <div class="content">
        <div class="week-header" id="weekHeader">
            <!-- –î–Ω–∏ –Ω–µ–¥–µ–ª–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
        </div>
        <div id="scheduleContainer">
            <!-- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
            <div class="loading" id="loading">
                –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è...
            </div>
        </div>
    </div>

    <div id="syncNotice" class="sync-notice" style="display: none;">
        ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
    </div>

    <div id="cacheNotice" class="cache-notice" style="display: none;">
        ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    </div>

    <script>
        // ================= –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø =================
        const SUPABASE_URL = 'https://rtywenfvaoxsjdku1mdk.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ0eXd1bmZ2YW94c2pka3UxbWRrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzU2MDQ4MDAsImV4cCI6MjA1MTE4MDgwMH0.gQ99aMJ_sUnOMR4XQm54gOq3MSF6hjePjEn4nyI6mFg';
        
        // –î–Ω–∏ –Ω–µ–¥–µ–ª–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        const DAYS = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
        const FULL_DAYS = ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞', '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'];
        
        // –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã
        const TIME_SLOTS = [
            '8:00-9:30', '9:30-11:00', '11:00-12:30',
            '12:30-14:00', '14:00-15:30', '15:30-17:00', '17:00-18:30'
        ];
        
        // –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        let currentUser = null;
        let currentSchedule = [];
        let pendingChanges = {};
        
        // ================= –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =================
        document.addEventListener('DOMContentLoaded', init);
        
        async function init() {
            console.log('üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            
            try {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
                if (window.Telegram && Telegram.WebApp) {
                    Telegram.WebApp.ready();
                    Telegram.WebApp.expand();
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                await loadUser();
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                showError('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
            }
        }
        
        // ================= –ó–ê–ì–†–£–ó–ö–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø =================
        async function loadUser() {
            try {
                // –ü–æ–ª—É—á–∞–µ–º Telegram ID –∏–∑ URL –∏–ª–∏ WebApp
                let tgId = '913096324'; // –¢–≤–æ–π ID –¥–ª—è —Ç–µ—Å—Ç–∞
                
                // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ Telegram WebApp
                if (window.Telegram && Telegram.WebApp && Telegram.WebApp.initDataUnsafe) {
                    const tgUser = Telegram.WebApp.initDataUnsafe.user;
                    if (tgUser && tgUser.id) {
                        tgId = tgUser.id.toString();
                    }
                }
                
                // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                const urlParams = new URLSearchParams(window.location.search);
                const urlTgId = urlParams.get('tgId');
                if (urlTgId) {
                    tgId = urlTgId;
                }
                
                console.log('üîÑ –ó–∞–≥—Ä—É–∂–∞—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å ID:', tgId);
                
                // –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ Supabase
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/users?telegram_id=eq.${tgId}&select=*`,
                    {
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`,
                            'Content-Type': 'application/json'
                        }
                    }
                );
                
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ ${response.status}`);
                }
                
                const users = await response.json();
                console.log('üìä –û—Ç–≤–µ—Ç –æ—Ç Supabase:', users);
                
                if (users && users.length > 0) {
                    currentUser = users[0];
                    document.getElementById('userName').textContent = currentUser.full_name || '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å';
                    console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω:', currentUser);
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
                    await loadSchedule();
                    
                } else {
                    console.log('‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ');
                    document.getElementById('userName').textContent = '–ì–æ—Å—Ç—å';
                    showDemoSchedule();
                }
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                document.getElementById('userName').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                showDemoSchedule();
            }
        }
        
        // ================= –ó–ê–ì–†–£–ó–ö–ê –†–ê–°–ü–ò–°–ê–ù–ò–Ø =================
        async function loadSchedule() {
            try {
                if (!currentUser) {
                    console.log('‚ö†Ô∏è –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∑–∞–≥—Ä—É–∂–∞—é –¥–µ–º–æ');
                    showDemoSchedule();
                    return;
                }
                
                console.log('üìÖ –ó–∞–≥—Ä—É–∂–∞—é —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è teacher_id:', currentUser.id);
                
                // –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ Supabase
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/schedules?teacher_id=eq.${currentUser.id}&select=*&order=day_of_week.asc,time_slot.asc`,
                    {
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`,
                            'Content-Type': 'application/json'
                        }
                    }
                );
                
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ ${response.status}`);
                }
                
                currentSchedule = await response.json();
                console.log('‚úÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ:', currentSchedule.length, '–∑–∞–ø–∏—Å–µ–π');
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
                renderSchedule(currentSchedule);
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                document.getElementById('loading').style.display = 'none';
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è:', error);
                showDemoSchedule();
            }
        }
        
        // ================= –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –†–ê–°–ü–ò–°–ê–ù–ò–Ø =================
        function renderSchedule(scheduleData) {
            console.log('üé® –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞—é —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ...');
            
            const container = document.getElementById('scheduleContainer');
            container.innerHTML = '';
            
            // –°–æ–∑–¥–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –¥–Ω—è–º–∏ –Ω–µ–¥–µ–ª–∏
            const weekHeader = document.getElementById('weekHeader');
            weekHeader.innerHTML = '<div class="time-label"></div>';
            
            DAYS.forEach((day, index) => {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'day-name';
                dayDiv.textContent = day;
                weekHeader.appendChild(dayDiv);
            });
            
            // –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä–æ–∫–∏ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Å–ª–æ—Ç–∞–º–∏
            TIME_SLOTS.forEach((timeSlot, timeIndex) => {
                const timeRow = document.createElement('div');
                timeRow.className = 'time-row';
                
                // –ú–µ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏
                const timeLabel = document.createElement('div');
                timeLabel.className = 'time-label';
                timeLabel.textContent = timeSlot.split('-')[0];
                timeRow.appendChild(timeLabel);
                
                // –°–ª–æ—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è
                const slotsDiv = document.createElement('div');
                slotsDiv.className = 'slots';
                
                DAYS.forEach((day, dayIndex) => {
                    const dayNumber = dayIndex + 1;
                    const slotData = scheduleData.find(item => 
                        item.day_of_week === dayNumber && item.time_slot === timeSlot
                    );
                    
                    const slotStatus = slotData ? slotData.status : 0;
                    
                    const slot = document.createElement('div');
                    slot.className = `slot state-${slotStatus}`;
                    slot.dataset.day = dayNumber;
                    slot.dataset.time = timeSlot;
                    
                    slot.innerHTML = `
                        <div class="slot-time">${timeSlot}</div>
                        <div>${getStatusText(slotStatus)}</div>
                    `;
                    
                    // –ö–ª–∏–∫ –ø–æ —Å–ª–æ—Ç—É –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å
                    slot.onclick = () => toggleSlotStatus(dayNumber, timeSlot, slotStatus);
                    
                    slotsDiv.appendChild(slot);
                });
                
                timeRow.appendChild(slotsDiv);
                container.appendChild(timeRow);
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
            updateLastSyncTime();
        }
        
        // ================= –ò–ó–ú–ï–ù–ï–ù–ò–ï –°–¢–ê–¢–£–°–ê –°–õ–û–¢–ê =================
        async function toggleSlotStatus(day, time, currentStatus) {
            try {
                const newStatus = (currentStatus + 1) % 3; // 0‚Üí1‚Üí2‚Üí0
                
                console.log(`üîÑ –ò–∑–º–µ–Ω—è—é —Å–ª–æ—Ç: –¥–µ–Ω—å ${day}, –≤—Ä–µ–º—è ${time}, —Å—Ç–∞—Ç—É—Å ${currentStatus}‚Üí${newStatus}`);
                
                if (!currentUser) {
                    console.error('‚ùå –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                    return;
                }
                
                // –ù–∞—Ö–æ–¥–∏–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å
                const existingSlot = currentSchedule.find(item => 
                    item.day_of_week === day && item.time_slot === time
                );
                
                if (existingSlot) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å
                    const response = await fetch(
                        `${SUPABASE_URL}/rest/v1/schedules?id=eq.${existingSlot.id}`,
                        {
                            method: 'PATCH',
                            headers: {
                                'apikey': SUPABASE_KEY,
                                'Authorization': `Bearer ${SUPABASE_KEY}`,
                                'Content-Type': 'application/json',
                                'Prefer': 'return=representation'
                            },
                            body: JSON.stringify({
                                status: newStatus,
                                updated_at: new Date().toISOString()
                            })
                        }
                    );
                    
                    if (!response.ok) {
                        throw new Error(`–û—à–∏–±–∫–∞ ${response.status}`);
                    }
                    
                    console.log('‚úÖ –°–ª–æ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω –≤ –±–∞–∑–µ');
                    
                } else {
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å
                    const response = await fetch(
                        `${SUPABASE_URL}/rest/v1/schedules`,
                        {
                            method: 'POST',
                            headers: {
                                'apikey': SUPABASE_KEY,
                                'Authorization': `Bearer ${SUPABASE_KEY}`,
                                'Content-Type': 'application/json',
                                'Prefer': 'return=representation'
                            },
                            body: JSON.stringify({
                                teacher_id: currentUser.id,
                                day_of_week: day,
                                time_slot: time,
                                status: newStatus,
                                created_at: new Date().toISOString(),
                                updated_at: new Date().toISOString()
                            })
                        }
                    );
                    
                    if (!response.ok) {
                        throw new Error(`–û—à–∏–±–∫–∞ ${response.status}`);
                    }
                    
                    console.log('‚úÖ –ù–æ–≤—ã–π —Å–ª–æ—Ç —Å–æ–∑–¥–∞–Ω –≤ –±–∞–∑–µ');
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                await loadSchedule();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                showSyncNotice();
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π');
            }
        }
        
        // ================= –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò =================
        function getStatusText(status) {
            switch(status) {
                case 0: return '–°–≤–æ–±–æ–¥–µ–Ω';
                case 1: return '–ó–∞–Ω—è—Ç';
                case 2: return '–ù–µ —Ä–∞–±–æ—Ç–∞—é';
                default: return '–°–≤–æ–±–æ–¥–µ–Ω';
            }
        }
        
        function showDemoSchedule() {
            console.log('üìä –ü–æ–∫–∞–∑—ã–≤–∞—é –¥–µ–º–æ-—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ');
            
            // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
            const demoData = [
                { day_of_week: 1, time_slot: '8:00-9:30', status: 0 },
                { day_of_week: 1, time_slot: '9:30-11:00', status: 1 },
                { day_of_week: 1, time_slot: '11:00-12:30', status: 0 },
                { day_of_week: 2, time_slot: '8:00-9:30', status: 0 },
                { day_of_week: 2, time_slot: '9:30-11:00', status: 2 },
                { day_of_week: 3, time_slot: '11:00-12:30', status: 1 },
                { day_of_week: 4, time_slot: '14:00-15:30', status: 0 },
                { day_of_week: 5, time_slot: '15:30-17:00', status: 1 }
            ];
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∫—ç—à–µ
            document.getElementById('cacheNotice').style.display = 'block';
            setTimeout(() => {
                document.getElementById('cacheNotice').style.display = 'none';
            }, 3000);
            
            renderSchedule(demoData);
            document.getElementById('loading').style.display = 'none';
        }
        
        function showSyncNotice() {
            const notice = document.getElementById('syncNotice');
            notice.style.display = 'block';
            
            setTimeout(() => {
                notice.style.display = 'none';
            }, 2000);
            
            updateLastSyncTime();
        }
        
        function updateLastSyncTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ru-RU', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            document.getElementById('lastSync').textContent = `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${timeStr}`;
        }
        
        function showError(message) {
            const container = document.getElementById('scheduleContainer');
            container.innerHTML = `
                <div class="error">
                    <h3>‚ùå –û—à–∏–±–∫–∞</h3>
                    <p>${message}</p>
                    <button onclick="location.reload()" style="
                        background: #238636;
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 8px;
                        margin-top: 15px;
                        cursor: pointer;
                    ">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
                </div>
            `;
        }
        
        function forceRefresh() {
            console.log('üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ...');
            loadSchedule();
        }
        
        function showSchedule() {
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∫–æ–¥ –ø–æ–∫–∞–∑–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
            console.log('–ü–æ–∫–∞–∑—ã–≤–∞—é —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ');
        }
        
        function showBookings() {
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É –∑–∞—è–≤–æ–∫
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∫–æ–¥ –ø–æ–∫–∞–∑–∞ –∑–∞—è–≤–æ–∫
            console.log('–ü–æ–∫–∞–∑—ã–≤–∞—é –∑–∞—è–≤–∫–∏');
            alert('–§—É–Ω–∫—Ü–∏—è –∑–∞—è–≤–æ–∫ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }
        
        function showStudents() {
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É —É—á–µ–Ω–∏–∫–æ–≤
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∫–æ–¥ –ø–æ–∫–∞–∑–∞ —É—á–µ–Ω–∏–∫–æ–≤
            console.log('–ü–æ–∫–∞–∑—ã–≤–∞—é —É—á–µ–Ω–∏–∫–æ–≤');
            alert('–§—É–Ω–∫—Ü–∏—è —É—á–µ–Ω–∏–∫–æ–≤ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }
    </script>
</body>
</html>
